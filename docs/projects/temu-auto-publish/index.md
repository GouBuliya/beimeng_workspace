# Temu商品发布自动化项目实施方案

**编制日期**：2025年10月25日  
**更新日期**：2025年10月30日 - 架构已更新为纯 Playwright 实现  
**预计工期**：1-2个月（可根据实际调整）

## 技术方案确定

经过对比 Playwright 纯代码、n8n 工作流、影刀 RPA 三种方案，**最终选择纯 Playwright + Python 架构**：

### 选型理由
- ✅ **纯代码实现**：完全可控，无外部 RPA 工具依赖
- ✅ **异步高效**：使用 Python asyncio 和 Playwright 异步 API
- ✅ **反检测能力强**：集成 playwright-stealth
- ✅ **易于调试和维护**：完整的日志和截图功能
- ✅ **工程化**：符合 SOTA 模式，可长期维护
- ✅ **免费开源**：无商业软件授权费用

### 架构设计
```
选品表(Excel) → Python读取处理 → 生成任务数据(JSON) 
                                        ↓
             Playwright 浏览器自动化 ← Python 异步控制
                          ↓
                   结果记录(JSON) → 数据统计
```



## 实施计划

### Phase 1: 基础架构（已完成 ✅）

**目标**：搭建完整的技术基础和数据处理层

#### ✅ 环境和项目结构
- Python 3.12 开发环境
- Playwright 安装和配置
- playwright-stealth 反检测集成
- 项目结构初始化（符合工作区规范）

#### ✅ 数据处理层
- Excel 读取器（pandas + openpyxl）
- 价格计算器（建议售价 = 成本 × 7.5，供货价 = 成本 × 10）
- AI 标题生成器（支持多种模式）
- Pydantic 数据模型（ProductInput, TaskProduct, TaskData）
- 完整的类型提示和数据验证

#### ✅ 浏览器自动化基础
- BrowserManager：浏览器管理、反检测、Cookie
- LoginController：异步登录、Cookie 复用
- 完整的错误处理和截图功能
- 日志系统（Loguru）

**Phase 1 验收**：✅ 数据处理层和浏览器基础框架完成

---

### Phase 2: 核心业务流程（进行中 🚧）

**目标**：实现搜索、编辑、发布的完整业务逻辑

#### 🚧 Day 1-3：调整页面选择器
使用 Playwright codegen 工具获取实际选择器：
```bash
uv run playwright codegen https://seller.temu.com
```

**需要调整的控制器**：
- **SearchController**: 搜索输入框、商品列表项、分页等
- **EditController**: 认领按钮、标题输入、类目选择、价格输入等
- **LoginController**: 微调登录相关选择器（如需要）

**注意事项**：
- 使用多种定位策略（text、role、data-testid等）
- 添加 fallback 选择器
- 考虑页面加载时机（networkidle、domcontentloaded）

#### 🚧 Day 4-6：完善搜索采集流程
基于实际页面结构完善 SearchController：
- 导航到搜索页面
- 输入关键词并触发搜索
- 等待结果加载（处理动态渲染）
- 提取商品信息（标题、价格、链接）
- 添加随机延迟（1-3秒）
- 错误处理和重试机制

**难点**：
- 商品筛选逻辑
- 动态加载内容的等待
- 去重处理

#### 🚧 Day 7-10：完善编辑流程
基于实际页面结构完善 EditController：

**首次编辑**（5条→20条）：
- 打开采集的商品链接
- 点击认领按钮 4 次
- 修改标题（中文 + 触发英文AI生成）
- 选择类目（可能需要处理树形结构）
- 保存并验证

**批量编辑18步**：
1. ✅ 标题（已在首次编辑完成）
2. 类目属性（参考采集链接，需要复杂逻辑）
3. 主货号（跳过）
4. 外包装（长方体/硬包装）
5. 产地（浙江）
6-7. 定制品、敏感属性（跳过）
8. 重量（5000-9999G 随机）
9. 尺寸（50-99cm，长>宽>高）
10. 平台SKU（自定义编码）
11. SKU分类（组合装500件）
12. 尺码表（跳过）
13. ✅ 建议售价（已实现基础版）
14-16. 包装清单、轮播图、颜色图（跳过）
17. 产品说明书（上传文件）
18. 保存并验证

**注意事项**：
- 每步之间添加随机延迟
- 详细的错误日志
- 关键步骤截图
- 支持断点续传

#### 📅 Day 11-12：批量发布
实现 PublishController：
- 选择目标店铺
- 设置供货价
- 批量发布操作（点击2次，共40条）
- 抓取发布结果
- 统计成功/失败数量
- 失败原因分析

#### 📅 Day 13-14：流程编排和优化
- 主程序串联所有流程
- 实现智能重试机制（指数退避）
- 断点续传功能
- 并发支持（可选）
- 性能监控和统计

**Phase 2 验收**：能够自动完成从选品表到发布的完整流程

---

### Phase 3: 测试和优化（3-5天）

**目标**：确保系统稳定可靠

#### 📅 Day 15-17：完整测试
- **功能测试**：至少 3 种不同类型的产品
- **稳定性测试**：连续处理 10+ 产品无崩溃
- **性能测试**：单个产品处理时间
- **错误率统计**：目标 < 20%

**测试场景**：
1. 简单类目商品（如电子产品）
2. 复杂类目商品（多级分类）
3. 特殊情况（无货源、价格异常等）

#### 📅 Day 18-19：问题修复和优化
- 根据测试结果修复 bug
- 优化选择器稳定性
- 调整延迟时间
- 完善错误处理

#### 📅 Day 20：文档和交付
- 更新使用说明文档
- 常见问题 FAQ
- 部署指南
- 代码注释检查

**Phase 3 验收**：系统稳定运行，错误率在可接受范围内

---




## 风险与应对

### 技术风险

#### 1. 网站反爬虫机制
- **风险等级**：中
- **应对措施**：
  - ✅ 已集成 playwright-stealth 反检测
  - ✅ 每步添加随机延迟（1-3秒）
  - ✅ 使用真实浏览器环境（Chromium）
  - ✅ Cookie 管理减少重复登录
  - 控制操作频率，避免过快
- **如果被封**：
  - 更换 User-Agent
  - 调整操作间隔
  - 联系平台申请白名单（如可能）

#### 2. 页面元素变化
- **风险等级**：中高
- **应对措施**：
  - 使用多种定位策略（text、role、data-testid、xpath）
  - 为关键元素配置 fallback 选择器
  - 添加元素存在性检查
  - 定期（每周）验证流程是否正常
- **缓解方案**：
  - 使用 Playwright codegen 快速更新选择器
  - 完整的错误日志和截图
  - 版本控制，快速回滚

#### 3. 图片验证困难
- **风险等级**：低
- **应对措施**：
  - MVP 阶段：人工确认 + 脚本辅助
  - 后续优化：接入视觉模型（Qwen-VL、GPT-4V等）
  - 截图保存供人工审核
- **注意事项**：
  - 图片验证不阻塞主流程
  - 提供明确的人工介入点

#### 4. 验证码和登录问题
- **风险等级**：中
- **应对措施**：
  - Cookie 复用，减少登录频率
  - 支持手动完成验证码
  - 浏览器保持可见（headless=False）
  - 预留足够的人工介入时间
- **未来优化**：
  - 接入验证码识别服务
  - 多账号轮换

#### 5. 性能和稳定性
- **风险等级**：中
- **应对措施**：
  - 完整的异常处理
  - 智能重试机制（指数退避）
  - 断点续传功能
  - 详细的日志和监控
  - 定期内存清理




## 技术栈详情

### 核心技术
- **Python 3.12+**: 现代 Python 特性，类型提示
- **Playwright**: 浏览器自动化，支持异步
- **playwright-stealth**: 反检测，降低被识别风险
- **asyncio**: 异步编程，提升效率

### 数据处理
- **Pydantic v2**: 数据验证和模型定义
- **pandas**: Excel 读取和数据处理
- **openpyxl**: Excel 文件操作

### 开发工具
- **Typer**: CLI 框架
- **Loguru**: 日志系统
- **Rich**: 终端美化输出
- **pytest**: 测试框架
- **ruff**: 代码格式化和检查
- **mypy**: 类型检查

### 优势
1. **纯代码实现**：完全可控，易于维护
2. **异步高效**：支持并发操作
3. **类型安全**：完整的类型提示
4. **工程化**：符合 SOTA 标准
5. **免费开源**：无授权费用

---

## 后续优化方向

### Phase 4: 功能增强（可选）

如果 MVP 版本稳定运行，可以考虑以下优化：

#### 1. 智能化升级
- 🤖 **图片自动验证**：接入 Qwen-VL、GPT-4V 等视觉模型
- 🧠 **智能异常处理**：基于历史数据自动调整策略
- 📊 **数据分析**：商品表现分析和优化建议

#### 2. 性能优化
- ⚡ **并发处理**：多账号/多任务并行
- 🔄 **智能调度**：根据平台流量选择最佳时间
- 💾 **缓存优化**：减少重复操作

#### 3. 用户体验
- 🌐 **Web 管理界面**：方便运营人员使用
- 📱 **移动端监控**：随时查看执行状态
- 📧 **消息通知**：关键事件提醒（邮件、微信等）

#### 4. 企业级功能
- 👥 **多用户支持**：权限管理
- 📈 **详细报表**：数据可视化
- 🔐 **安全加固**：敏感信息加密
- 🔄 **自动更新**：选择器自动适配

#### 5. 生态集成
- 🔌 **API 接口**：与其他系统集成
- 📦 **Docker 部署**：一键部署
- ☁️ **云端运行**：无需本地环境

---

## 项目价值

### 效率提升
- **时间节省**：单个商品从 30+ 分钟降至 5 分钟
- **错误率降低**：人工操作错误率 15-20% → 自动化 < 5%
- **规模化**：支持批量处理，可扩展

### 成本优势
- **无授权费**：完全开源免费
- **易维护**：纯代码，技术门槛低
- **可定制**：根据业务需求灵活调整

### 技术优势
- **SOTA 标准**：符合最佳工程实践
- **长期可维护**：清晰的代码结构
- **可扩展性强**：模块化设计

---

**备注**：本方案采用 MVP（最小可行产品）迭代策略，优先实现核心流程自动化，后续根据实际使用反馈逐步优化和扩展功能。

