# Temu商品发布自动化项目实施方案 v2.0

**编制日期**：2025年10月25日  
**重大更新**：2025年10月30日 - 基于实际 SOP 操作手册调整方案  
**预计工期**：2-3周（基于妙手工具流程）

---

## 🔍 重大发现：使用妙手工具

通过分析实际 SOP 操作手册，发现：
- ❌ **不是**直接操作 Temu 原生后台
- ✅ **实际使用**「妙手」采集箱工具
- ✅ 流程更加标准化和可预测

### 妙手工具优势
- 统一的采集箱界面
- 批量编辑功能
- 标准化的认领机制
- 更稳定的选择器

---

## 📊 实际业务流程（基于 SOP）

```
选品表(Excel) 
    ↓
【步骤1】访问 Temu 前端店铺
    ↓
【步骤2】站内搜索同款商品（根据选品表规格筛选）
    ↓
【步骤3】采集 5 条同款商品链接
    ↓
【步骤4】妙手采集箱 - 首次编辑（5条）
    ├── 4.1 使用 AI 重新生成 5 个标题（必须加型号）
    ├── 4.2 核对类目
    ├── 4.3 核对并替换不一致图片（头图/轮播图/SKU图）
    ├── 4.4 补充尺寸图和产品视频
    └── 4.5 保存修改
    ↓
【步骤5】每条链接认领 4 次 → 5条 × 4 = 20条
    ↓
【步骤6】检查认领结果（验证 20 条存在）
    ↓
【步骤7】妙手采集箱 - 批量二次编辑（20条，18步）
    ├── 7.1  标题（预览+保存）
    ├── 7.2  英语标题（空格触发AI）
    ├── 7.3  类目属性（参考采集链接）⚠️ 复杂
    ├── 7.4  主货号（跳过）
    ├── 7.5  外包装（长方体/硬包装 + 图片）
    ├── 7.6  产地（浙江）
    ├── 7.7  定制品（跳过）
    ├── 7.8  敏感属性（跳过）
    ├── 7.9  重量（5000-9999G 随机）
    ├── 7.10 尺寸（50-99cm，长>宽>高）
    ├── 7.11 平台SKU（自定义编码）
    ├── 7.12 SKU分类（组合装500件）
    ├── 7.13 尺码表（跳过）
    ├── 7.14 建议售价（成本价 × 10）
    ├── 7.15 包装清单（跳过）
    ├── 7.16 轮播图（跳过）
    ├── 7.17 颜色图（跳过）
    └── 7.18 产品说明书（上传文件）⚠️ 需文件
    ↓
【步骤8】选择店铺（20条全选）
    ↓
【步骤9】设置供货价（真实供货价 × 3）
    ↓
【步骤10】批量发布（点击2次 → 40条链接）
    ↓
【步骤11】查看发布结果
    └── 正常：成功 50-100 条
    └── 异常：查看失败原因
```

---

## 🎯 技术方案更新

### 架构设计 v2.0

```
选品表(Excel) → Python 数据处理 → 任务数据(JSON)
                                        ↓
                    【妙手工具网页】←  Playwright 自动化
                      ├── 公共采集箱
                      ├── 首次编辑（5条）
                      ├── 认领机制（→20条）
                      ├── 批量编辑（18步）
                      └── 批量发布
                                        ↓
                           结果记录(JSON) → 统计分析
```

### 核心技术栈

| 技术 | 用途 | 版本 |
|------|------|------|
| Python | 主语言 | 3.12+ |
| Playwright | 浏览器自动化 | 1.48+ |
| playwright-stealth | 反检测 | 1.0+ |
| Pydantic | 数据验证 | v2 |
| pandas | Excel处理 | 2.2+ |
| Loguru | 日志系统 | 0.7+ |
| Typer | CLI框架 | 0.12+ |

---

## 📋 实施计划（2-3周）

### Week 1: 环境和基础流程 ✅

#### Day 1-2: 环境准备 ✅
- [x] Python 3.12+ 环境确认
- [x] Playwright + Chromium 安装
- [x] playwright-stealth 反检测测试
- [x] 项目结构初始化
- [x] 配置系统实现
- [x] Git 仓库配置

#### Day 3: 数据处理层验证 ✅
- [x] Excel 读取器测试
- [x] 价格计算器测试（需更新倍率）
- [x] 标题生成器测试
- [x] 数据模型完整性检查

#### Day 4-5: 登录和妙手访问 🚧
- [ ] 登录 Temu 商家后台
- [ ] 一键访问前端店铺
- [ ] 访问妙手采集箱页面
- [ ] Cookie 持久化测试

### Week 2: 核心自动化流程 🚧

#### Day 6-7: 搜索和采集（步骤1-3）
**目标**：自动搜索并采集 5 条同款链接

**关键页面元素**：
- Temu 前端店铺搜索框
- 商品列表项选择器
- 采集按钮（如果有）
- 链接提取逻辑

**验证标准**：
- 采集的 5 条商品链接符合选品表规格
- 图片、尺寸一致性验证

**注意事项**：
- ⚠️ 需要图片相似度对比（可选用 CV 模型或人工）
- ⚠️ 尺寸/颜色匹配逻辑

#### Day 8-9: 首次编辑（步骤4）
**目标**：完成 5 条链接的首次编辑

**核心功能**：
1. **标题生成**（AI 辅助）
   - 提取高频热搜词
   - 生成 5 个新标题
   - 添加型号后缀（必须）
   - 可选修饰词（2025新款等）

2. **类目验证**
   - 检查类目是否可用
   - 不确定的标记为需人工确认

3. **图片处理**
   - 检查头图/轮播图/SKU图一致性
   - 删除/替换不一致图片
   - ⚠️ 关键难点：需要图像对比

4. **补充素材**
   - 从采集链接复制尺寸图
   - 从采集链接复制产品视频
   - 使用网络图片上传

**实现方式**：
- AI 标题生成器（已有）
- 图片对比逻辑（新增，可选 MVP 跳过）
- 素材复制粘贴自动化

#### Day 10-11: 认领和检查（步骤5-6）
**目标**：自动认领并验证

**操作步骤**：
1. 遍历 5 条链接
2. 每条点击「认领」按钮 4 次
3. 验证采集箱中有 20 条（5 × 4）
4. 截图保存验证结果

**关键选择器**：
- 认领按钮
- 采集箱列表项
- 分页控件（20条/页）

#### Day 12-14: 批量编辑 18 步（步骤7）⭐核心
**目标**：自动完成 20 条链接的批量编辑

**实现策略**：

##### 简单步骤（固定值或跳过）：
- 7.1, 7.4, 7.7, 7.8, 7.13, 7.15, 7.16, 7.17: 直接预览+保存
- 7.2: 空格触发 AI
- 7.5: 固定值（长方体/硬包装）
- 7.6: 固定值（浙江）
- 7.9: 随机值（5000-9999G）
- 7.10: 随机值（50-99cm，长>宽>高）
- 7.11: 自定义SKU编码
- 7.12: 固定值（组合装500件）
- 7.14: 计算值（成本价 × 10）

##### 复杂步骤（需特殊处理）：
- **7.3 类目属性** ⚠️ 最难
  - 需要参考采集链接的类目
  - 可能有多级树形结构
  - MVP 策略：人工预处理或简化逻辑

- **7.18 产品说明书** ⚠️ 需文件
  - 需要上传实际文件
  - MVP 策略：使用统一模板文件

**选择器需求**：
- 批量编辑按钮
- 18 个编辑项的展开/输入框
- 预览按钮
- 保存按钮
- 进度提示

### Week 3: 发布和优化 📅

#### Day 15: 店铺选择和供货价（步骤8-9）
**目标**：设置店铺和价格

**操作步骤**：
1. 全选 20 条链接
2. 点击「选择店铺」
3. 选择指定店铺
4. 点击「设置供货价」
5. 计算供货价 = 真实供货价 × 3
   - 真实供货价 = 成本价 × 2.5-3

**关键计算**：
```python
真实供货价 = 成本价 × 2.5  # 最低倍率
妙手供货价 = 真实供货价 × 3 = 成本价 × 7.5
```

#### Day 16: 批量发布（步骤10-11）
**目标**：完成发布并验证

**操作步骤**：
1. 全选 20 条链接
2. 点击「批量发布」
3. 第1次确认发布（20条）
4. 第2次确认发布（20条）
5. 总计发布 40 条
6. 等待发布完成
7. 查看发布记录
8. 统计成功/失败数量
9. 记录失败原因

**验证标准**：
- 成功率 50-100 条（预期范围）
- 失败原因记录清晰

#### Day 17-19: 集成测试和优化
**目标**：端到端流程打通

**测试用例**：
1. 简单商品（固定类目）
2. 复杂商品（多级类目）
3. 批量处理（3-5个产品）

**优化项**：
- 选择器稳定性
- 错误处理完善
- 重试机制
- 日志详细度
- 性能调优

#### Day 20-21: 文档和交付
- 使用说明文档
- 故障排查指南
- 常见问题 FAQ
- 演示视频（可选）

---

## 🔧 技术实现要点

### 1. 价格计算更新

根据 SOP 手册，价格计算逻辑需要调整：

```python
# 旧版（之前的理解）
建议售价 = 成本价 × 7.5
供货价 = 成本价 × 10

# 新版（基于 SOP）
建议售价 = 成本价 × 10  # 步骤 7.14
真实供货价 = 成本价 × 2.5  # 最低倍率
妙手供货价 = 真实供货价 × 3 = 成本价 × 7.5  # 步骤 9
```

### 2. 标题生成规则

**AI 提示词模板**（来自 SOP）：
```
提取上面5个商品标题中的高频热搜词，写5个新的中文标题，不要出现药品、急救等医疗相关的词汇
符合欧美人的阅读习惯，符合TEMU/亚马逊平台规则，提高搜索流量
```

**标题后缀（必须）**：
- 型号：如 A0001 型号
- 可选修饰词：2025新款 / 适用于456种场景 / 节日必备

### 3. 随机数据生成

```python
# 重量：5000-9999G
import random
weight = random.randint(5000, 9999)

# 尺寸：50-99cm，长>宽>高
length = random.randint(70, 99)
width = random.randint(60, length-1)
height = random.randint(50, width-1)
```

### 4. 固定值配置

```python
# 外包装
packaging_shape = "长方体"
packaging_type = "硬包装"

# 产地
origin = "浙江"

# SKU分类
sku_category = "组合装500件"
```

### 5. 妙手页面选择器策略

**关键页面**：
- 登录页：`https://seller.temu.com/login`
- 妙手采集箱：需要实际调研URL
- 批量编辑页：在采集箱内

**选择器获取方法**：
```bash
# 使用 Playwright codegen 录制操作
uv run playwright codegen https://seller.temu.com

# 生成代码后提取选择器
```

**fallback 策略**：
- 使用 text + role + testid 多重定位
- 添加 timeout 和 retry
- 关键步骤截图

---

## 🎭 模块设计更新

### 新增模块

```python
# src/browser/miaoshou_controller.py
class MiaoshouController:
    """妙手采集箱控制器"""
    
    async def navigate_to_collection_box(self) -> None:
        """导航到公共采集箱"""
        
    async def first_edit(self, links: List[str]) -> None:
        """首次编辑 5 条链接"""
        
    async def claim_links(self, count: int = 4) -> None:
        """认领链接（每条认领 count 次）"""
        
    async def verify_claims(self, expected: int = 20) -> bool:
        """验证认领结果"""
        
    async def batch_edit_18_steps(self) -> None:
        """批量编辑 18 步"""
        
    async def select_shop(self, shop_name: str) -> None:
        """选择店铺"""
        
    async def set_supply_price(self, price: float) -> None:
        """设置供货价"""
        
    async def batch_publish(self) -> PublishResult:
        """批量发布（点击2次）"""
```

### 更新现有模块

```python
# src/data_processor/price_calculator.py
class PriceCalculator:
    """更新价格计算逻辑"""
    
    def calculate_suggested_price(self, cost: float) -> float:
        """建议售价 = 成本 × 10"""
        return cost * 10
        
    def calculate_supply_price(self, cost: float) -> float:
        """供货价 = 成本 × 7.5"""
        return cost * 7.5
```

---

## ⚠️ 关键风险和应对

### 1. 图片一致性验证 🔴 高风险
**问题**：需要验证采集的商品图片与选品表一致

**MVP 方案**：
- 人工预先筛选采集链接
- 脚本仅执行后续自动化步骤
- 提供图片对比界面供人工确认

**优化方案**（Phase 2）：
- 接入图像相似度算法（如 SSIM、特征匹配）
- 使用视觉模型（Qwen-VL、GPT-4V）自动判断

### 2. 类目属性复杂逻辑 🟡 中风险
**问题**：需要参考采集链接的类目属性

**MVP 方案**：
- 人工预设常用类目的属性映射表
- 复杂类目暂时跳过或人工介入
- 记录类目属性模板复用

**优化方案**（Phase 2）：
- 建立类目属性知识库
- 自动学习和匹配

### 3. 妙手页面选择器稳定性 🟡 中风险
**问题**：妙手工具页面结构可能变化

**应对措施**：
- 多重定位策略（text + role + xpath）
- 定期验证和更新选择器
- 完整的错误日志和截图
- 快速回滚机制

### 4. 产品说明书文件 🟢 低风险
**问题**：需要上传实际文件

**MVP 方案**：
- 使用统一的通用模板文件
- 放在 `data/templates/product_manual.pdf`

**优化方案**（Phase 2）：
- 根据类目使用不同模板
- 自动生成个性化说明书

---

## 📊 自动化程度评估

| 步骤 | 自动化程度 | 说明 |
|------|-----------|------|
| 1. 访问店铺 | ✅ 100% | 简单导航 |
| 2. 搜索同款 | ⚠️ 70% | 搜索自动，筛选需辅助 |
| 3. 采集链接 | ✅ 90% | 基本自动，需验证 |
| 4. 首次编辑 | ⚠️ 60% | 标题AI，图片需人工 |
| 5. 认领链接 | ✅ 100% | 完全自动 |
| 6. 验证认领 | ✅ 100% | 完全自动 |
| 7.1-7.2 标题 | ✅ 90% | AI生成 |
| 7.3 类目属性 | ⚠️ 50% | 复杂逻辑 |
| 7.4-7.17 其他 | ✅ 95% | 固定值/计算值 |
| 7.18 说明书 | ⚠️ 80% | 通用模板 |
| 8. 选择店铺 | ✅ 100% | 完全自动 |
| 9. 设置供货价 | ✅ 100% | 完全自动 |
| 10. 批量发布 | ✅ 100% | 完全自动 |
| 11. 查看结果 | ✅ 100% | 完全自动 |

**总体自动化程度**：约 **85%**

**人工介入点**：
1. 图片一致性验证（可选）
2. 复杂类目属性（可选）
3. 异常情况处理

---

## 🎯 MVP 交付标准

### 最小可行产品（2-3周）

**核心功能**：
- ✅ 读取选品表
- ✅ 计算价格（更新后的规则）
- ✅ 生成 AI 标题
- ✅ 登录 Temu 后台
- ✅ 访问妙手采集箱
- ✅ 搜索并采集 5 条链接（半自动）
- ✅ 首次编辑（标题+类目，图片人工）
- ✅ 自动认领 4 次
- ✅ 批量编辑 18 步（简化版）
- ✅ 批量发布
- ✅ 结果统计

**成功标准**：
- 单个产品端到端流程<15分钟（人工辅助）
- 成功率 >80%
- 错误日志完整
- 可重复执行

---

## 🚀 后续优化方向

### Phase 2: 智能化（1-2周）
- 图片自动验证（CV模型）
- 类目属性智能匹配
- 异常自动重试
- 多产品并发处理

### Phase 3: 产品化（2-3周）
- Web 管理界面
- 实时进度监控
- 数据分析报表
- 多账号支持

---

## 📚 相关文档

- [发布操作手册](./guides/发布操作手册.md) - SOP 详细步骤
- [数据格式规范](./guides/data-format.md) - 输入输出格式
- [Week 1 任务](./week1/) - 详细开发计划

---

**更新说明**：本方案基于实际 SOP 操作手册重新设计，更加贴合实际业务流程。

